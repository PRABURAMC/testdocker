trigger:
  - none  
pool:
  vmImage: 'ubuntu-latest'

variables:
  acrName: 'prabuaksregistry'
  imageName: 'apache'
  imageTag: '41'
  aksCluster: 'prabu-aks'
  helmChartPath: 'helm/'

steps:
  # Step1: Install Helm on the Pipeline Agent
  - task: HelmInstaller@0
    inputs:
      helmVersion: 'latest'

  # Step 2: Deploy to AKS using Helm
  - task: HelmDeploy@0
    inputs:
      azureSubscription: 'AKS-Service-Connection'
      azureResourceGroup: 'AKS-CLUSTER1'
      kubernetesCluster: '$(aksCluster)'
      namespace: 'default'
      command: 'upgrade'
      chartType: 'FilePath'
      chartPath: '$(helmChartPath)'
      releaseName: 'app'
      arguments: >
        --set image.repository=$(acrName).azurecr.io/$(acrName).azurecr.io/$(imageName) 
        --set image.tag=latest

